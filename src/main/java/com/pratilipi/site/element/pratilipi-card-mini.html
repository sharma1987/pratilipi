<dom-module id="pratilipi-card-mini">

	<style>

		:host {
			display: inline-block;
			width: 160px;
			text-align:center;
			margin-bottom: 16px;
		}

		.pratilipi-card {
			width: 160px;
			height: 240px;
			display: block;
			cursor: pointer;
		}

		.ellipsed, a.ellipsed:hover, a.ellipsed:focus {
			line-height: 24px;
			text-align: center;
			color: #3d3d3d;
			display: block;
			font-size: 13px;
		}
		
		.pratilipi-title {
			font-weight: 700;
		}
		
		.white-snippet, .white-snippet-reduced {
			text-decoration: none;
			float: left;
			width: 160px;
			background: linear-gradient(to bottom, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
			text-align: center;
			color: #333;
		}
		
		.white-snippet {
			height: 60px;
			margin-top: 148px;
			margin-top: calc( 240px - 60px - 32px );
			padding: 4px 8px;
		}
		
		.white-snippet-reduced {
			height: 45px;
			margin-top: 163px;
			margin-top: calc( 240px - 45px - 32px );
			padding: 8px;
		}
		
		.meta-container {
			color: #7e7e7e;
			text-align: left;
			padding-bottom: 10px;
			background: #fbfbfb;
			height: 32px;
			margin-top: -32px;
		}
		
		.read-count {
			margin-left: 8px;
			font-size: 14px;
		}
		
		.read-count iron-icon {
			width: 16px; 
			height: 16px; 
			margin-top: -2px;
		}
		
		.rating-count {
			margin-right: 8px;
			font-size: 14px;
		}
		
	</style>


	<template>
		<div class="pratilipi-shadow">
			<span style="background-image: url({{ pratilipiCoverImage }});" class="pratilipi-card" on-click="redirectToContentPage" title="{{ fullTitle }}">
				<template is="dom-if" if="{{ pratilipi.author }}">
					<div class="white-snippet">
						<div class="contain-title ellipsed pratilipi-title">{{ title }}</div>
						<a href="{{ pratilipi.author.pageUrl }}"><span class="contain-title ellipsed">{{ pratilipi.author.name }}</span></a>
					</div>
				</template>
				<template is="dom-if" if="{{ !pratilipi.author }}">
					<div class="white-snippet-reduced">
						<div class="contain-title ellipsed pratilipi-title">{{ title }}</div>
					</div>
				</template>
			</span>
			<div class="meta-container">
				<span class="read-count">
					<iron-icon icon="icons:chrome-reader-mode"></iron-icon>
					{{ readText }}
				</span>
				<template is="dom-if" if="{{ showRating }}">
					<pratilipi-rating class="pull-right rating-count" value="{{ pratilipi.averageRating }}" mini></pratilipi-rating>
				</template>
			</div>
		</div>
	</template>


	<script>
		function abbrNum( n, d ) {
			if( n < 1000 ) return n;
			x = ( '' + n ).length, p = Math.pow, d = p( 10,d );
			x -= x % 3;
			return Math.round( n * d / p ( 10, x ) ) / d + " kMGTPE" [ x / 3 ]; 
		}

		Polymer({

			is: 'pratilipi-card-mini',

			properties: {
				pratilipi: { type: Object, observer: "_pratilipiObserver" }
			},
			
			_pratilipiObserver: function() {
				if( this.pratilipi.title != null && this.pratilipi.title.trim() != "" && this.pratilipi.titleEn != null && this.pratilipi.titleEn.trim() != null )
					this.fullTitle = this.pratilipi.title + " | " + this.pratilipi.titleEn;
				else if( this.pratilipi.title != null && this.pratilipi.title.trim() != "" )
					this.fullTitle = this.pratilipi.title;
				else
					this.fullTitle = this.pratilipi.titleEn;
				this.title = this.pratilipi.title != null && this.pratilipi.title.trim() != "" ? this.pratilipi.title : this.pratilipi.titleEn;
				this.pratilipiCoverImage = this.pratilipi.coverImageUrl + ( this.pratilipi.coverImageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=160";
				this.readText = abbrNum( this.pratilipi.readCount, 1 );
				this.showRating = this.pratilipi.averageRating == 0 ? false : true;
			},
			
			redirectToContentPage: function() {
				window.location.href = this.pratilipi.pageUrl;
			}
		
		});

	</script>

</dom-module>