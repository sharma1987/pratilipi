<dom-module id="pratilipi-user-login">

	<template>
		<div class="popup">
			<h5 class="popup-heading">${ _strings.sign_in_to_pratilipi }</h5>
			<div class="popup-body">
				<div class="form-group">
					<label for="FormInput-UserEmail">${ _strings.email }</label>
					<input type="email" class="form-control" id="FormInput-UserEmail" placeholder="name@example.com" value="{{ email::input }}">
				</div>
				<div class="form-group">
					<label for="FormInput-Password">${ _strings.password }</label>
					<input type="password" class="form-control" id="FormInput-Password" placeholder="********" value="{{ password::input }}">
				</div>
				<br/>
				<div class="text-center">
					<button type="button" class="btn" on-click="onSubmit">${ _strings.sign_in }</button>
				</div>
				<br/>
				<br/>
				<br/>
				<div class="small">
					<div class="pull-right">
						Not a member ? <a class="text-muted" href="#" on-click="register">Sign up !</a>
					</div>
					<a class="text-danger" href="#" on-click="resetPassword">Forgot Password ?</a>
				</div>
			</div>
		</div>
		
		<iron-ajax
				id="AjaxPut"
				url="/api/user/login"
				method="PUT"
				content-type="application/json"
				handle-as="json"
				on-response="_handleAjaxPutResponse"
				on-error="_handleAjaxPutError"
				></iron-ajax>
		
	</template>
	
	
	<script>

		Polymer({

 			is: 'pratilipi-user-login',

			properties: {
				email: { type: String },
				password: { type: String },
			},
			
			behaviors: [
				Polymer.IronOverlayBehavior
			],

			register: function() {
				document.querySelector( 'pratilipi-user' ).register();
			},
			
			resetPassword: function() {
				document.querySelector( 'pratilipi-user' ).resetPassword();
			},

			onSubmit: function() {
				var ajaxPut = this.$.AjaxPut;
				ajaxPut.body = JSON.stringify( { email:this.email, password:this.password } );
				ajaxPut.generateRequest();
			},
			
			_handleAjaxPutResponse: function(  request ) {
				if( ! request.detail.response ) {
					// TODO: show error
					return;
				}
				
				this.close();
				document.querySelector( 'pratilipi-user' ).updateUser( request.detail.response );
			},

			_handleAjaxPutError: function() {
				// TODO: show error
			},
			
		});

	</script>
	
</dom-module>