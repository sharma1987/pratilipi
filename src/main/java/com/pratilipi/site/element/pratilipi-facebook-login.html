<dom-module id="pratilipi-facebook-login">

<template>
	<div id= "fb-login-container" style = "display:inline-block;">
 		<a href="#" on-click="fb_login">${ _strings.sign_in_with_facebook }</a>
	</div>			
	<iron-ajax
				id="AjaxPut"
				url="/api/user/login/facebook"
				method="PUT"
				content-type="application/json"
				handle-as="json"
				on-response="_handleAjaxPutResponse"
				on-error="_handleAjaxPutError"
				></iron-ajax>
</template>

<script>

	Polymer ({

		is: 'pratilipi-facebook-login',
		
		sendData: function( accessToken ) {
			this.$.AjaxPut.body = JSON.stringify ({ 
				fbUserAccessToken: 	accessToken });
			this.$.AjaxPut.generateRequest();
		},

		fb_login: function() {
			FB.init({
				appId: ${ fbAppId },
				cookie : true,
				xfbml: true,
				version: 'v2.0'
			});
			FB.login( function( response ) {
				document.querySelector( 'pratilipi-facebook-login' ).sendData( response.authResponse.accessToken );
			}, { scope: 'public_profile,email,user_birthday' } );
		},

		ready: function() {
			if( typeof(FB) == 'undefined' ) {
				(function(d, s, id) {
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) return;
					js = d.createElement(s); js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			}
		},

		_handleAjaxPutResponse: function( event ) {
			document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
		},

		_handleAjaxPutError: function( event ) {
			alert( event.detail.request.xhr.response.message );
		}, 

 	});

</script>
</dom-module>