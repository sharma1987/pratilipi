<dom-module id="pratilipi-facebook-login">

<template>
	<div id= "fb-login-container" style = "display:inline-block;">
 		<a href="#" on-click="fb_login">${ _strings.sign_in_with_facebook }</a>
	</div>			
	<iron-ajax
				id="AjaxPut"
				url="/api/user/login/facebook"
				method="PUT"
				content-type="application/json"
				handle-as="json"
				on-response="_handleAjaxPutResponse"
				on-error="_handleAjaxPutError"
				></iron-ajax>
</template>

<script>
	Polymer ({
		is: 'pratilipi-facebook-login',
		
		sendData: function( accessToken ) {
			this.$.AjaxPut.body = JSON.stringify ({ 
				fbUserAccessToken: 	accessToken });
			this.$.AjaxPut.generateRequest();
		},
		
		fb_login: function() {
			FB.login( function( response ) {
				FB.api( '/me', function( userData ) {
					document.querySelector( 'pratilipi-facebook-login' ).sendData( FB.getAuthResponse().accessToken );
			 	});
			}, { scope: 'public_profile,email,user_birthday' } );
		},
		
		 _handleAjaxPutResponse: function( event ) {
			document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
		},
		
		_handleAjaxPutError: function( event ) {
				alert( event.detail.request.xhr.response.message );
		}, 

 	});
</script>

</dom-module>