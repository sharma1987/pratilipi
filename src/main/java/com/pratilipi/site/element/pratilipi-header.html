<dom-module id="pratilipi-header">

	<style>
		paper-card {
			height: 75px;
			width: 100%;
		}
		
		.container, .container div {
			display: inline-block;
		}
		
		paper-input.search {
	        --paper-input-container-focus-color: #797979;
		}
		
		paper-input.search /deep/ ::-webkit-input-placeholder {
			font-size: 15px;
			font-family: Helvetica,'Noto Sans Tamil', sans-serif;
		}

		paper-input.search /deep/ ::-moz-placeholder {
			font-size: 15px;
			font-family: Helvetica,'Noto Sans Tamil', sans-serif;
		}

		paper-input.search /deep/ :-ms-input-placeholder {
			font-size: 15px;
			font-family: Helvetica,'Noto Sans Tamil', sans-serif;
		}
		
		paper-icon-button.search-icon {
			margin-bottom: -5px;
			margin-right: -10px;
		}
		
		paper-icon-button.menu-icon {
			margin-bottom: -5px;
			margin-left: -10px;
		}
		
		paper-item {
			--paper-item-min-height: 40px;
			--paper-item-min-width: 0px;
			--paper-item: {
				font-size: 13px;
				font-weight: 300;
				font-family: Helvetica,'Noto Sans Tamil', sans-serif;
				color: #333;
			};
		}
		
		iron-icon {
			--iron-icon-height: 20px;
			--iron-icon-width: 20px;
		}
		
	</style>

	<template>
		<paper-card>
			<div class="parent-container"> 
				<div class="container">
					<table style="min-width: 100%;">
						<tr>
							<td align="left" width="65px">
								<a href="/">
									<img style="padding-top: 5px; max-width: 60px;" title="${ _strings.pratilipi }" alt="${ _strings.pratilipi }" src="http://0.ptlp.co/resource-${ lang }/logo/pratilipi_logo.png" />
								</a>
							</td>
							
							<template is="dom-if" if="{{ !mobile }}">
								<td width="90px">
									<a href="/">
										<img style= "padding-top: 5px; max-width: 90px;" title="${ _strings.pratilipi }" alt="${ _strings.pratilipi }" src="http://0.ptlp.co/resource-${ lang }/logo/pratilipi_text.png" />
									</a>
								</td>
							</template>
							
							<template is="dom-if" if="{{ medium }}">
								<td width="25px"></td>
							</template>
							
							<td width="auto">
								<form id="searchForm" action="javascript:void(0);" style="margin: -20px 15px auto 10px;" on-keyup="onSubmit">
									<template is="dom-if" if="{{ !mobile }}">
										<paper-input id="searchInput" name="q" class="search" type="search" placeholder="${ _strings.search_bar_help }" onfocus="this.placeholder = ''" onblur="this.placeholder = '${ _strings.search_bar_help }'" value="{{ query::input }}">
											<paper-icon-button class="search-icon" suffix icon="search" noink="true" on-click="onSubmit"></paper-icon-button>
											<template is="dom-if" if="{{ !medium }}">
												<paper-icon-button class="menu-icon" prefix icon="menu" noink="true" on-click="showMenu"></paper-icon-button>
											</template>
										</paper-input>
									</template>
									<template is="dom-if" if="{{ mobile }}">
										<paper-input id="searchInput" name="q" class="search" type="search" placeholder="${ _strings.search }" onfocus="this.placeholder = ''" onblur="this.placeholder = '${ _strings.search }'" value="{{ query::input }}">
											<paper-icon-button class="search-icon" suffix icon="search" noink="true" on-click="onSubmit"></paper-icon-button>
											<paper-icon-button class="menu-icon" prefix icon="menu" noink="true" on-click="showMenu"></paper-icon-button>
										</paper-input>
									</template>
								</form>
							</td>
							
							<td align="right" width="90px">
								<template is="dom-if" if="{{ user.isGuest }}">
									<button type="button" class="pratilipi-white-button" on-click="logInButtonClicked"><small>${ _strings.user_sign_in }</small></button>
								</template>
								<template is="dom-if" if="{{ !user.isGuest }}">
									<div class="dropdown">
										<button style="width: 90px;" class="pratilipi-white-button dropdown-toggle" type="button" data-toggle="dropdown">
											<div style="width: 70px; text-align: center;" class="contain-title ellipsed">{{ user.displayName }}</div>
											<div style="margin-top: 7px; margin-right: 5px;" class="caret pull-right"></div>
										</button>
										<ul class="dropdown-menu pull-right">
											<li>
												<a style="padding: 5px; margin: 0;" href="#">
													<paper-item on-click="myProfile">
														<paper-icon-item><iron-icon style="color: #107FE5;" icon="description"></iron-icon></paper-icon-item>
														&nbsp;&nbsp;
														<paper-item-body>${ _strings.user_my_profile }</paper-item-body>
													</paper-item>
												</a>
											</li>
											<li>
												<a style="padding: 5px; margin: 0;" href="#">
													<paper-item on-click="myAccount">
														<paper-icon-item><iron-icon style="color: #107FE5;" icon="account-circle"></iron-icon></paper-icon-item>
														&nbsp;&nbsp;
														<paper-item-body>${ _strings.user_my_account }</paper-item-body>
													</paper-item>
												</a>
											</li>
											<li>
												<a style="padding: 5px; margin: 0;" href="#">
													<paper-item on-click="logOut">
														<paper-icon-item><iron-icon style="color: #D0021B;" icon="remove-circle"></iron-icon></paper-icon-item>
														&nbsp;&nbsp;
														<paper-item-body>${ _strings.user_sign_out }</paper-item-body>
													</paper-item>
												</a>
											</li>
										</ul>
									</div>
								</template>
							</td>

							
							<template is="dom-if" if="{{ !container }}">
								<template is="dom-if" if="{{ !mobile }}">
									<td width="10px"></td>
									<td width="85px">
										<button type="button" class="pratilipi-dark-blue-button" on-click="write"><iron-icon style="margin-top: -5px;" icon="create"></iron-icon>&nbsp;${ _strings.write }</button>
									</td>
								</template>
							</template>
						</tr>
					</table>
				</div>
				
				<template is="dom-if" if="{{ !mobile }}">
					<template is="dom-if" if="{{ container }}">
						<div style="position: absolute; display: inline-block; top: 12px; margin-left: 12px;">
							<button type="button" class="pratilipi-dark-blue-button" on-click="write"><iron-icon style="margin-top: -5px;" icon="create"></iron-icon>&nbsp;${ _strings.write }</button>
						</div>
					</template>
				</template>
			</div>
		</paper-card>
		
		<!-- Navigation & Search bar for extra-small & small screens. -->
		<div class="hidden-md hidden-lg">
			<pratilipi-navigation-drawer with-backdrop></pratilipi-navigation-drawer>
		</div>
		
	</template>


	<script>

		Polymer({
			
			is: 'pratilipi-header',
			
			behaviors: [
				Polymer.IronResizableBehavior
			],
			
			listeners: {
				'iron-resize': '_onIronResize'
			},
			
			properties: {
				user: { type: Object, observer: "_userChanged" },
				query: { type: String },
				
				writeButtonActive: { type: Boolean, value: false },
				
				/* Screen sizes */
				mobile: { type: Boolean },
				container: { type: Boolean },
				medium: { type: Boolean }
			},
			
			myAccount: function() {
				document.querySelector( 'pratilipi-edit-account' ).open();
			},
			
			myProfile: function() {
				// Redirect to MyProfile Page
				var windowLocation = window.location;
				var profilePageUrl = "http://" + window.location.host + this.user.profilePageUrl;
				if( this.user.profilePageUrl != null && windowLocation != profilePageUrl )
					window.location.href = profilePageUrl; 
			},
			
			_userChanged: function() {
				if( ! this.user.isGuest && this.writeButtonActive ) {
					this.async( function() {
						this.write();
					}, 1000 );
				}
			},
			
			write: function() {
				if( this.user.isGuest ) {
					this.writeButtonActive = true;
					document.querySelector( 'pratilipi-user' ).logIn();
				}
				else {
					this.writeButtonActive = false;
					document.querySelector( 'pratilipi-write' ).open();
				}
			},
			
			showMenu: function() {
				this.querySelector( 'pratilipi-navigation-drawer' ).show();
			},
			
			logInButtonClicked: function() {
				this.writeButtonActive = false;
				document.querySelector( 'pratilipi-user' ).logIn();
			},
			
			logOut: function() {
				document.querySelector( 'pratilipi-user' ).logOut();
			},
			
			_onIronResize: function() {
				var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
				
				if( windowsize > 600 )
					this.mobile = false;
				else
					this.mobile = true;

				if( windowsize > 1100 )
					this.container = true;
				else
					this.container = false;
				
				if( windowsize > 991 )
					this.medium = true;
				else
					this.medium = false;
					
			},
			
			onSubmit: function( event ) {
				
				if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 )
					return;
				
				var str = decodeURI( window.location.pathname );
				
				// Already in search page
				if( str == "/search" ) {
					document.querySelector( 'pratilipi-card-grid' ).setSearchQuery( jQuery( "#searchInput" ).val() );
				}
				else {
					jQuery( "#searchForm" ).prop( "action", "/search" );
					jQuery( "#searchForm" ).submit();
				}
				
			},

		});

	</script>

</dom-module>