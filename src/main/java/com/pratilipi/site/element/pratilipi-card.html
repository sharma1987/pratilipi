<link rel="import" href="pratilipi-rating.html">

<dom-module id="pratilipi-card">

	<style>
		
		paper-card {
			height: 200px;
			--paper-card-header: { display: none };
		}
		
		.card-heading {
			font-size: 16px;
			color: #434343;
			line-height: 20px;
		}
		
		.media {
			overflow: visible;
			min-width: 100%;
			padding: 10px;
		}
		
		.media-left img {
			width: 100px;
			height: 150px;
		}
		
	</style>


	<template>
		<paper-card>
			<div class="card-content">
				<div class="media">
					<div class="media-left">
						<a href="{{ pratilipi.pageUrlAlias }}">
							<img class="media-object" src="{{ pratilipi.coverImageUrl }}" alt="{{ pratilipi.title }}" title="{{ pratilipi.titleEn }}"/>
						</a>
					</div>
				  	<div class="media-body">
				  		<h4 class="media-heading">
						 	<a id="pratilipi-title" class="card-heading" href="{{ pratilipi.pageUrlAlias }}"  data-toggle="tooltip" data-placement="top" title="{{ pratilipi.title }}">{{ pratilipi.title }}</a>
						</h4>
						<h6>
							<a class="card-heading" style="font-size: 12px;" href="{{ pratilipi.author.pageUrlAlias }}">{{ pratilipi.author.name }}</a>
						</h6>
						<div>
							<pratilipi-rating value="{{ pratilipi.averageRating }}" />
							<span class="rating-text">&nbsp;({{ pratilipi.averageRating }})</span>
						</div>
						<div style="position: absolute; bottom: 25px;">
							<a on-click="redirectToReader" class="pratilipi-light-blue-button">${ _strings.pratilipi_read }</a>
						</div>
					</div>
				</div>
			</div>
		</paper-card>
	</template>


	<script>

		Polymer({

			is: 'pratilipi-card',
			
			behaviors: [
				Polymer.IronResizableBehavior
			],
          
			properties: {
				pratilipi: { type: Object }
			},
			
			listeners: {
				'iron-resize': '_onIronResize'
			},
			
			redirectToReader: function() {
				if( this.pratilipi.readPageUrl !== undefined ) 
					window.location.href = "http://www.pratilipi.com/read?id=" + this.pratilipi.readPageUrl.substring( 6 );
			},
			
			_onIronResize: function() {
				// Adjusting heading
				var heading = jQuery( this.querySelector( '#pratilipi-title' ) );
				
				var title = this.pratilipi.title;
				heading.text( title );
				var len = title.length;
				while( heading.height() > 62 && len > 1 ) {
					len = len - 1;
					heading.text( title.substring( 0, len - 20 ).trim() + "..." );
				}	
			}
		});

	</script>

</dom-module>