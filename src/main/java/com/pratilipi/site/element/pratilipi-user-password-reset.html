<dom-module id="pratilipi-user-password-reset">
	
	<style>
	
		.popup-heading span {
			font-size: 14px;
			color: #333;
			display: inline-block;
		}
		
		paper-input.pratilipi-blue {
			--paper-input-container-focus-color: #107FE5;
		}
		
	</style>

	<template>
		<div class="modal-content">
			<div class="modal-header">
				<span>${ _strings.forgot_password }</span>
				<span style="float: right;"><paper-icon-button style="margin-top: -10px; margin-right: -10px;" noink="true" icon="close" data-dismiss="modal"></paper-icon-button></span>
			</div>
			<div class="modal-body" on-keyup="onSubmit">
				<p class="text-muted">
					Please enter the e-mail address you signed up with.
					<br>
					We will send you a link to reset your password.
				</p>
				<div style="margin: 0px">
					<paper-input class="pratilipi-blue" type="email" label="Email" value="{{ email::input }}">
						<iron-icon style="margin-right: 5px;" icon="mail" prefix></iron-icon>
					</paper-input>
				</div>
				<div class="text-center">
					<br style="line-height: 10px;">
					<span style="display: block; margin: 0px;" class="text-center">{{ message }}</span>
					<br style="line-height: 10px;">
					<a style="margin-top: 0px;" class="pratilipi-dark-blue-button" on-click="onSubmit">${ _strings.reset_password }</a>
				</div>
			</div>
			<div class="modal-footer">
				<a style="float: left;" class="text-muted" href="#" on-click="logIn">Back</a>
			</div>
		</div>
		
		<iron-ajax
            id="AjaxPost"
            url="/api/user/email"
            method="POST"
			content-type="application/json"
			handle-as="json"
            on-response="_handleAjaxPostResponse"
            on-error="_handleAjaxPostError"
            ></iron-ajax>
				
	</template>

   
	<script>
		Polymer({

			is: 'pratilipi-user-password-reset',

			properties: {
				email: { type: String, value: "" },
				message: { type: String, value: "" }
			},
			
			logIn: function() {
				document.querySelector( 'pratilipi-user' ).logIn();
			},
			
			clearMessages: function() {
				this.message = "";
			},
			
			onSubmit: function( event ) {
				this.clearMessages();
				
				if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 )
					return;
				
				if( this.email === "" ) {
					this.message = "Please enter your email";
					return;
				}
					
				
				this.message = "Working ...";
				
				var ajaxPost = this.$.AjaxPost;
				ajaxPost.params = { email: this.email, sendPasswordResetMail: true };
				ajaxPost.generateRequest();
			},
			
			_handleAjaxPostResponse: function( event ) {
				this.clearMessages();
				if( event.detail.xhr.status == 0 ) {
					this.message = "Could not connect to server !";
				} else {
					this.message= "A mail has been sent to your email Id! ";
					this.async( function() {
						this.message = null;
						jQuery( "#pratilipiUserPasswordReset" ).modal( 'hide' );
					}, 3000 );
				}
			},
			
			_handleAjaxPostError: function( event ) {
				this.clearMessages();
				if( event.detail.request.xhr.response.email != null )
					this.message = event.detail.request.xhr.response.email;
				else
					this.message = event.detail.request.xhr.response.message;
			},
		});
		
	</script>

</dom-module>