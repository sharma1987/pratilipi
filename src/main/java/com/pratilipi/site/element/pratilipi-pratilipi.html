<link rel="import" href="pratilipi-rating.html" />
<link rel="import" href="pratilipi-social.html" />
<link rel="import" href="pratilipi-rating-input.html" />

<dom-module id="pratilipi-pratilipi">

	<style>
	
		:host {
			display: block;
		}

		.media {
			padding: 10px;
		}
		
		
		.media-left {
			padding: 10px;
		}
		
		.media-left img {
			width: 150px;
			height: 225px;
		}


		.media-body {
			padding: 10px;
		}
		
		.media-body h1, .media-body h4 {
			margin: 5px 0px;
		}

		.media-body .btn {
			border-radius: 0px;
			padding: 3px 20px;
		}

	</style>

	<template>
		<div class="secondary-500">
			<div class="media">
	
				<div class="media-left">
					<img class="media-object" src="{{ pratilipi.coverImageUrl }}" alt="{{ pratilipi.title }}" title="{{ pratilipi.titleEn }}"/>
					<div style="text-align:center">
						<pratilipi-rating-input
								user="{{ user }}"
								pratilipi-id="{{ pratilipi.pratilipiId }}"
								value="{{ userpratilipi.rating }}"
								></pratilipi-rating-input>
						<pratilipi-social shareUrl="getShareUrl"></pratilipi-social>
					</div>
				</div>
				
				<div class="media-body">
					<div>
						<h1 class="media-heading">{{ pratilipi.title }}</h1>
						<h4><a href="{{ pratilipi.author.pageUrlAlias }}">{{ pratilipi.author.name }}</a></h4>
						<div>
							<pratilipi-rating value="{{ pratilipi.averageRating }}">
								<small>{{ getRatingsStr( pratilipi.ratingCount ) }}</small>
							</pratilipi-rating>
						</div>
						<div>
							<a href="{{ pratilipi.readerPageUrl }}" class="btn btn-success">Read For Free</a>
							<a href="#ReviewSection" class="btn btn-primary">Review This Book</a>
						</div>
						<hr>
						<div style="text-align: justify; padding:10px 0px;">
							<span class="summary">{{ pratilipi.summary }}</span>
							<a href="#" class="show-more" on-click="showCompleteSummary"><small>(show more)</small></a>
							<a href="#" class="show-less" on-click="showSummarySnippet"><small>(show less)</small></a>
						</div>	
						<hr>	
					</div>
				</div>
	
			</div>
			<hr/>
		</div>
	</template>
	

	<script>

		Polymer({

			is: 'pratilipi-pratilipi',
			
			properties: {
				user: { type: Object },
				pratilipi: { type:Object },
				userpratilipi: { type:Object, notify:true }
			},
			
			getRatingsStr: function( ratingCount ) {
				return '(' + this.pratilipi.ratingCount + ' ' + ( this.pratilipi.ratingCount <= 1 ? '${ _strings.rating }' : '${ _strings.ratings }' ) + ')';
			},

			getShareUrl: function() {
				return 'http://www.pratilipi.com/' + pratilipi.pageUrl;
			},
			
			showCompleteSummary: function() {
				jQuery( '.summary' ).html( this.pratilipi.summary );
				jQuery( '.show-more' ).hide();
				jQuery( '.show-less' ).show();
			},
			
			showSummarySnippet: function() {
				jQuery( '.summary' ).text( jQuery( '.summary' ).text().substr( 0, 200 ) + '...' );
				jQuery( '.show-more' ).show();
				jQuery( '.show-less' ).hide();
			},
			
			ready: function() {
				jQuery( '.summary' ).html( this.pratilipi.summary );
				this.showSummarySnippet();
			}
			
		});
		
		
	</script>

</dom-module>