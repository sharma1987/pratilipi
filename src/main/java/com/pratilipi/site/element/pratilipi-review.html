<dom-module id="pratilipi-review">

	<style>
		
		:host {
			display: block;
		}
		
		paper-card#reviewcard {
			width: 100%;
			margin-bottom: 5px;
			padding: 20px;
		}
		
		.user-name {
			color: #333; 
			text-transform: capitalize; 
			display: inline-block; 
			margin: 0px;
			font-size: 15px;
		}
		
		.user-dp {
			width: 64px; 
			height: 64px; 
			float: left; 
		}

		.reviewText {
			text-align: justify; 
			white-space:pre-wrap; 
			font-size: 15px;
			margin: 16px 0px 16px 8px;
		}
		
		a.reply-text {
			margin-right: 16px;
			font-size: 15px;
		}
		
		a.expand-comments {
			font-size: 15px;
			color: #333;
		}
		
		a.expand-comments iron-icon {
			margin-left: -4px;
			width: 16px;
		}
		
		.reply-section {
			margin-bottom: 16px;
		}
		
		paper-menu-button {
			padding: 0px;
		}
		
		paper-menu {
			cursor: pointer;
			--paper-menu-color: #333;
			--paper-menu-focused-item: {
				color: #107FE5;
			};
		}
		
		paper-item {
			font-family: inherit;
			font-size: inherit;
			margin-left: 4px;
			margin-right: 4px;
		}

	</style>

	
	<template>
		<paper-card id="reviewcard">
			<template is="dom-if" if="{{ hasAccessToUpdate }}">
				<paper-menu-button horizontal-align="right" class="pull-right">
					<paper-icon-button class="dropdown-trigger" icon="icons:more-horiz" noink></paper-icon-button>
						<paper-menu class="dropdown-content">
							<paper-item on-click="showReviewInput">
								<iron-icon style="margin-right: 8px;" icon="icons:create"></iron-icon>
								${ _strings.review_edit_review }
							</paper-item>
							<paper-item on-click="openDeleteReview">
								<iron-icon style="margin-right: 8px;" icon="icons:delete"></iron-icon>
								${ _strings.review_delete_review }
							</paper-item>
						</paper-menu>
				</paper-menu-button>
			</template>
			<div>
   				<a href="{{ review.userProfilePageUrl }}">
   					<img class="img-circle user-dp pratilipi-shadow" src="{{ reviewUserImageUrl }}" alt="{{ user.userName }}" title="{{ user.userName }}"/>
   				</a>
   				<div style="display: inline-block; margin-left: 16px;">
   					<a class="user-name" href="{{ review.userProfilePageUrl }}">{{ review.userName }}</a>
	   				<pratilipi-rating value="{{ review.rating }}" />
	   				<span style="display: block;">{{ reviewDateMillis }}</span>
   				</div>
			</div>
			<div class="reviewText">{{ reviewText }}</div>
			<div class="reply-section">
				<a class="reply-text pratilipi-red" on-click="writeComment">
					${ _strings.comment_reply_comment }
				</a>
				<br/>
				<a class="expand-comments" on-click="showOrHideComments">
					<iron-icon icon="icons:unfold-more"></iron-icon>
					${ _strings.comment_see_all_comments }
					<#-- <iron-icon icon="{{ expandedIcon }}"></iron-icon> -->
				</a>
			</div>
			
			<pratilipi-comment-list
				id="comment-{{ review.userPratilipiId }}"
				user="{{ user }}"
				parent-id="{{ review.userPratilipiId }}"
				parent-type="REVIEW"></pratilipi-comment-list>
		</paper-card>
	</template>
	

	<script>
	
		Polymer({

			is: 'pratilipi-review',
			
			properties: {
				user: { type: Object },
				review: { type: Object, observer: "ready" },
				
				<#-- expandedIcon: { type: String, value: "icons:arrow-drop-down" }, -->
				hasAccessToUpdate: { type: Boolean, value: false }
			},
			
			ready: function() {
				
				if( ( this.review.reviewTitle == null || this.review.reviewTitle.trim() == "" )
						&& ( this.review.review == null || this.review.review.trim() == "" ) ) {
					this.$.reviewcard.style.display =  'none';
					return;
				}
				
				var reviewText = "";
				
				if( this.review.reviewTitle != null && this.review.reviewTitle.trim() != "" )
					reviewText = this.review.reviewTitle + "\n\n";
					
				if( this.review.review != null && this.review.review.trim() != "" )
					reviewText = reviewText + this.review.review;
					
				this.set( 'reviewText', reviewText );

				if( this.review.userImageUrl ) {
					if( this.review.userImageUrl.indexOf( '?' ) == -1 )
						this.reviewUserImageUrl = this.review.userImageUrl + "?" + "width=64";
					else
						this.reviewUserImageUrl = this.review.userImageUrl + "&" + "width=64";
				}
				
				if( this.review.reviewDateMillis )
					this.reviewDateMillis = convertDate( this.review.reviewDateMillis );
			},
			
			writeComment: function() {
				this.querySelector( 'pratilipi-comment-list' ).writeComment();
				<#-- this.expandedIcon = "icons:arrow-drop-up"; -->
			},
			
			showOrHideComments: function() {
				this.querySelector( 'pratilipi-comment-list' ).showOrHideComments( this.review.userPratilipiId );
				<#--
				if( this.expandedIcon == "icons:arrow-drop-down" )
					this.expandedIcon = "icons:arrow-drop-up";
				else
					this.expandedIcon = "icons:arrow-drop-down";
				-->
			},
			
			
			showReviewInput: function() {
				this.domHost.showReviewInput();
			},
			
			openDeleteReview: function() {
				this.domHost.openDeleteReview();
			}

		});
		
	</script>

</dom-module>
