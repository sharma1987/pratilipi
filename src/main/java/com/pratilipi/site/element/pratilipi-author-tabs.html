<#include "pratilipi-author-drafted-contents.html">
<#include "pratilipi-author-published-contents.html">
<#include "pratilipi-author-library-contents.html">
<#include "pratilipi-author-biography.html">
<#include "pratilipi-author-following.html">
<#include "pratilipi-author-followers.html">
<#-- <#include "pratilipi-author-recent-contents.html"> -->

<dom-module id="pratilipi-author-tabs">
	<style>
		:host {
			display: block;
			margin-bottom: 12px;
		}
		.nav-tabs>li>a {
			font-size: 16px;
			line-height: 32px;
			border: none;
			color: #333;
		}
		.nav-tabs, .nav-tabs>li>a:hover {
			border-bottom: none;
			border-top: none;
			border-left: none;
			border-right: none;
			background: none;
		}
		.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
			border-bottom: 3px solid #107FE5;
			border-top: none;
			border-left: none;
			border-right: none;
			background: none;
		}
		.fade {
			opacity: 0;
			-webkit-transition: opacity 0.05s linear;
			-moz-transition: opacity 0.05s linear;
			-o-transition: opacity 0.05s linear;
			transition: opacity 0.05s linear;
		}
		.fade.in {
			opacity: 1;
			-webkit-transition: opacity 0.05s linear;
			-moz-transition: opacity 0.05s linear;
			-o-transition: opacity 0.05s linear;
			transition: opacity 0.05s linear;
	}
	</style>
	<template>
		<div class="secondary-500 pratilipi-shadow">
			<ul class="nav nav-tabs" role="tablist">
				<li style="width: 50%;" role="presentation" class="active">	<a href="#author-activity" 	class="text-center" aria-controls="author-activity" role="tab" data-toggle="tab">Activity</a>	</li>
				<li style="width: 50%;" role="presentation">				<a href="#author-about" 	class="text-center" aria-controls="author-about" 	role="tab" data-toggle="tab">About</a>		</li>
			</ul>
		</div>
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane fade in active" id="author-activity">

				<template is="dom-if" if="{{ hasAccessToUpdate }}">
					<pratilipi-author-drafted-contents 
						author="[[ author ]]"></pratilipi-author-drafted-contents>
				</template>

				<pratilipi-author-published-contents 
						pratilipi-list-object="[[ publishedPratilipiList ]]" 
						author="[[ author ]]"></pratilipi-author-published-contents>

				<template is="dom-if" if="{{ hasAccessToUpdate }}">
					<pratilipi-author-library-contents></pratilipi-author-library-contents>
				</template>

			</div>
			<div role="tabpanel" class="tab-pane fade" id="author-about">
				<pratilipi-author-biography author="[[ author ]]"></pratilipi-author-biography>
				<pratilipi-author-following following-list="{{ followingList }}"></pratilipi-author-following>
				<pratilipi-author-followers followers-list="{{ followersList }}"></pratilipi-author-followers>
			</div>
		</div>
		<iron-ajax
				id="PratilipiApi"
				url="/api/pratilipi"
				method="POST"
				content-type="application/x-www-form-urlencoded"
				handle-as="json"
				on-response="_pratilipiApiResponse"
				on-error="_pratilipiApiError"
				></iron-ajax>
	</template>
	<script>
	Polymer({

		is: 'pratilipi-author-tabs',
		
		properties: {
			author: { type: Object, observer: "_authorObserver" },

			publishedPratilipiList: { type: Object },

			followingList: { type: Object },
			followersList: { type: Object }
		},
		
		_authorObserver: function() {
			this.set( 'hasAccessToUpdate', this.author.hasAccessToUpdate );
		},

		moveContentToDrafts: function( pratilipiId ) {
			this.$.PratilipiApi.body = jQuery.param( {"pratilipiId": pratilipiId, "state": "DRAFTED" } );
			this.$.PratilipiApi.generateRequest();
		},

		publishContent: function( pratilipiId ) {
			this.$.PratilipiApi.body = jQuery.param( {"pratilipiId": pratilipiId, "state": "PUBLISHED" } );
			this.$.PratilipiApi.generateRequest();
		},

		deleteContent: function( pratilipiId ) {
			this.$.PratilipiApi.body = jQuery.param( {"pratilipiId": pratilipiId, "state": "DELETED" } );
			this.$.PratilipiApi.generateRequest();
		},

		_pratilipiApiResponse: function( response ) {

			var pratilipi = response.detail.response;

			if( pratilipi.state == "DRAFTED" ) {
				this.querySelector( 'pratilipi-author-published-contents' ).removeFromPratilipiList( pratilipi.pratilipiId );
				this.querySelector( 'pratilipi-author-drafted-contents' ).addToPratilipiList( pratilipi );
			} else if( pratilipi.state == "PUBLISHED" ) {
				this.querySelector( 'pratilipi-author-drafted-contents' ).removeFromPratilipiList( pratilipi.pratilipiId );
				this.querySelector( 'pratilipi-author-published-contents' ).addToPratilipiList( pratilipi );
			} else if( pratilipi.state == "DELETED" ) {
				document.querySelector( 'pratilipi-alert' ).alert( "You have deleted the book successfully!" );
				window.location.reload();
			}

		}
		
	});
	</script>
</dom-module>