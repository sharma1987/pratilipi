<dom-module id="pratilipi-reader-navigation">

	<style>
		
		:host {
			position: fixed;
			left: 0;
			z-index: 1040;
			margin-left: 7px;
			margin-right: 5px;
		}
		
		#pratilipiReaderNavigation paper-card {
			padding: 5px 2px;
			overflow: auto;
		}
		
	</style>


	<template>
		<iron-collapse id="pratilipiReaderNavigation">
			<paper-card id="navigationPaperCard">
				<template is="dom-repeat" items="{{ modifiedIndex }}">
					<pratilipi-reader-navigation-entry entry="{{ item }}" page-no="{{ pageNo }}"></pratilipi-reader-navigation-entry>
					<br class="pratilipi-break">
				</template>
				
				<dom-module id="pratilipi-reader-navigation-entry">
					<style>
						a.heading, a.heading:hover, a.heading:focus {
							font-weight: 600;
						}
						a.grey, a.grey:hover, a.grey:focus {
							color: #707070;
						}
						a.black, a.black:hover, a.black:focus {
							color: #333;
						}
						a.blue, a.blue:hover, a.blue:focus {
							color: #107FE5;
						}
						.menu-item {
							padding: 12px 18px; 
							max-width: 275px;
						}
					</style>
					<template>
						<a id="entry" on-click="_entrySelected">
							<div class="menu-item">
								[[ entry.title ]]
							</div>
						</a>
					</template>
					<script>
						Polymer({
							is: 'pratilipi-reader-navigation-entry',
							
							properties: {
								entry: { type: Object },
								pageNo: { type: Number, observer: "_pageNoChanged" }
							},
							
							attached: function() {
								if( this.entry.level == 0 )
									jQuery( this.querySelector( '#entry' ) ).addClass( "heading" );
							},
							
							_pageNoChanged: function() {
								if( this.pageNo == this.entry.pageNo ) {
									jQuery( this.querySelector( '#entry' ) ).removeClass( "black" );
									jQuery( this.querySelector( '#entry' ) ).removeClass( "grey" );
									jQuery( this.querySelector( '#entry' ) ).addClass( "blue" );
								} else {
									jQuery( this.querySelector( '#entry' ) ).removeClass( "blue" );
									if( this.entry.level == 0 )
										jQuery( this.querySelector( '#entry' ) ).addClass( "black" );
									else
										jQuery( this.querySelector( '#entry' ) ).addClass( "grey" );
								}
							},
							
							_entrySelected: function() {
								document.querySelector( 'pratilipi-reader-page' ).setPageNo( this.entry.pageNo );
							} 
						
						});
					</script>
				</dom-module>
				
			</paper-card>
		</iron-collapse>
	</template>
	
	
	<script>

		Polymer({
			
			is: 'pratilipi-reader-navigation',
			
			properties: {
				index: { type: Array },
				pageNo: { type: Number },
				modifiedIndex: { type: Array, value: [] }
			},
			
			attached: function() {
				if( this.index != null )
					for( var i = 0; i < this.index.length; i++ )
						this.push( 'modifiedIndex', this.index[i] );
				
				jQuery( "#navigationPaperCard" ).css( "max-height", jQuery( window ).height() - 80 );
			},
			
			toggleNavigation: function() {
				this.$.pratilipiReaderNavigation.toggle();
			},
			
			closeNavigation: function() {
				if( this.$.pratilipiReaderNavigation.opened )
					this.toggleNavigation();
			}
						
		});

	</script>

</dom-module>